import getOffsetParent from './getOffsetParent';
import getScrollParent from './getScrollParent';
import getOffsetRect from './getOffsetRect';
import getPosition from './getPosition';

/**
 * Computed the boundaries limits and return them
 * @method
 * @memberof Popper.Utils
 * @param {Object} data - Object containing the property "offsets" generated by `_getOffsets`
 * @param {Number} padding - Boundaries padding
 * @param {Element} boundariesElement - Element used to define the boundaries
 * @returns {Object} Coordinates of the boundaries
 */
export default function getBoundaries(popper, padding, boundariesElement) {
    // NOTE: 1 DOM access here
    let boundaries = {};

    if (boundariesElement === 'window') {
        // WINDOW
        console.log('WINDOW');
        const body = window.document.body;
        const html = window.document.documentElement;
        const height = Math.max( body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight );
        const width = Math.max( body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth );

        boundaries = {
            top: 0,
            right: width,
            bottom: height,
            left: 0
        };
    } else if (boundariesElement === 'viewport') {
        // VIEWPORT
        console.log('VIEWPORT');
        const offsetParent = getOffsetParent(popper);
        const scrollParent = getScrollParent(popper);
        const offsetParentRect = getOffsetRect(offsetParent);
        const position = getPosition(popper);

        if (position === 'fixed') {
            boundaries = {
                top: 0,
                right: window.document.documentElement.clientWidth,
                bottom: window.document.documentElement.clientHeight,
                left: 0,
            }
        } else {
            const scrollTop = scrollParent.scrollTop;
            const scrollLeft =scrollParent.scrollLeft;

            boundaries = {
                top: 0 - (offsetParentRect.top - scrollTop),
                right: window.document.documentElement.clientWidth - (offsetParentRect.left - scrollLeft),
                bottom: window.document.documentElement.clientHeight - (offsetParentRect.top - scrollTop),
                left: 0 - (offsetParentRect.left - scrollLeft)
            };
        }

    } else if (getOffsetParent(popper) === boundariesElement || boundariesElement === 'offsetParent') {
        // OFFSET PARENT IS BOUNDARIES ELEMENT
        console.log('OFFSET PARENT IS BOUNDARIES ELEMENT OR OFFSET PARENT EXPLICIT');
        boundaries = {
            top: 0,
            left: 0,
            right: boundariesElement.clientWidth,
            bottom: boundariesElement.clientHeight,
        };
    } else {
        // BOUNDARIES ELEMENT
        console.log('BOUNDARIES ELEMENT');
        boundaries = getOffsetRect(boundariesElement);
    }

    boundaries.left += padding;
    boundaries.right -= padding;
    boundaries.top = boundaries.top + padding;
    boundaries.bottom = boundaries.bottom - padding;

    return boundaries;
}
